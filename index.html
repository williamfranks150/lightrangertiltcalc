<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>Light Ranger Tilt Calculator</title>

  <!-- iOS standalone -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="LR Tilt" />

  <meta name="theme-color" content="#000000" />
  <link rel="manifest" href="manifest.json" />

  <style>
    :root{
      --bg:#000;
      --fg:#fff;
      --muted:rgba(255,255,255,.65);
      --line:rgba(255,255,255,.18);
      --field:rgba(255,255,255,.08);
    }

    html, body { height: 100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family:-apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing:antialiased;

      padding:
        calc(env(safe-area-inset-top) + 18px)
        calc(env(safe-area-inset-right) + 18px)
        calc(env(safe-area-inset-bottom) + 18px)
        calc(env(safe-area-inset-left) + 18px);

      display:flex;
      justify-content:center;
      align-items:flex-start;
    }

    .wrap{ width:min(560px,100%); }

    h2{
      margin:10px 0 18px;
      font-size:28px;
      font-weight:700;
      text-align:center;
    }

    label{
      display:block;
      margin-top:14px;
      margin-bottom:6px;
      font-weight:700;
      font-size:14px;
      text-align:left;
    }

    input, select, button{
      width:100%;
      box-sizing:border-box;
      border-radius:10px;
      border:1px solid var(--line);
      background:var(--field);
      color:var(--fg);
      padding:12px;
      font-size:18px;
      text-align:center;
      outline:none;
    }

    .inline-group{
      display:flex;
      gap:10px;
    }
    .inline-group > div{ flex:1; }

    .radio-title{
      margin-top:16px;
      font-weight:800;
      font-size:14px;
      text-align:left;
    }

    .radio-group{
      margin-top:8px;
      display:flex;
      gap:10px;
    }

    .radio-pill{
      flex:1;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      display:flex;
      justify-content:center;
      align-items:center;
      gap:6px;
      font-size:14px;
    }

    .divider{
      margin-top:14px;
      height:1px;
      background:rgba(255,255,255,.12);
    }

    .actions{
      margin-top:18px;
    }

    #calcBtn{
      font-weight:800;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.25);
    }

    #result{
      margin-top:18px;
      font-size:28px;
      font-weight:900;
      text-align:center;
    }

    #resetBtn{
      margin-top:10px;
      background:transparent;
      border:none;
      font-size:14px;
      color:rgba(255,255,255,.75);
    }
  </style>
</head>

<body>
<div class="wrap">

  <h2>Light Ranger Tilt Calculator</h2>

  <label>Focal Length (mm)</label>
  <input type="number" id="focal" inputmode="numeric" />

  <label>Subject Distance to Focal Plane</label>
  <div class="inline-group">
    <div><input type="number" id="feet" placeholder="Feet" /></div>
    <div><input type="number" id="inches" placeholder="Inches" /></div>
  </div>

  <div class="radio-title">Frame Height</div>
  <div class="radio-group">
    <label class="radio-pill"><input type="radio" name="frame" value="top" checked />Top Third</label>
    <label class="radio-pill"><input type="radio" name="frame" value="middle" />Middle</label>
    <label class="radio-pill"><input type="radio" name="frame" value="bottom" />Bottom Third</label>
  </div>

  <label style="margin-top:16px;">Light Ranger Sensor Distance to Focal Plane</label>
  <div class="inline-group">
    <div><input type="number" id="lr_offset" placeholder="Horizontal Offset (in)" /></div>
    <div><input type="number" id="lr_height" placeholder="Vertical Offset (in)" /></div>
  </div>

  <div class="divider"></div>

  <label>Camera Body</label>
  <select id="cameraBody">
    <option value="">-- Select Body --</option>
  </select>

  <label>Format / Sensor Mode</label>
  <select id="formatMode" disabled>
    <option value="">-- Select Format --</option>
  </select>

  <div class="actions">
    <button id="calcBtn">CALCULATE</button>
  </div>

  <div id="result">Tilt Angle —</div>
  <button id="resetBtn">RESET</button>

</div>

<script>
/* ===== CAMERA DATABASE (unchanged) ===== */
const CAMERA_DB = {
  "ARRI ALEXA 35":[
    {label:"4.6K 3:2 Open Gate",vmm:19.22},
    {label:"4.6K 16:9",vmm:15.75},
    {label:"4K 16:9",vmm:14.00},
    {label:"UHD",vmm:13.12},
    {label:"4K 2:1",vmm:12.44},
    {label:"3.3K 6:5",vmm:16.95},
    {label:"3K 1:1",vmm:18.66},
    {label:"2K S16",vmm:7.00}
  ],

  "Sony VENICE":[
    {label:"6K FF 3:2",vmm:24.00},
    {label:"6K FF 17:9",vmm:19.00},
    {label:"5.7K FF 16:9",vmm:19.00},
    {label:"4K S35 4:3",vmm:18.00},
    {label:"4K S35 16:9",vmm:12.80}
  ],

  "RED KOMODO":[
    {label:"6K 17:9",vmm:14.26},
    {label:"6K 2:1",vmm:13.52},
    {label:"6K 2.4:1",vmm:11.32},
    {label:"6K 16:9",vmm:14.26}
  ]
};

/* ===== UI ===== */
const $ = id => document.getElementById(id);
let activeSensorMM = null;

function populateBodies(){
  Object.keys(CAMERA_DB).forEach(b=>{
    const o=document.createElement("option");
    o.value=b; o.textContent=b;
    $("cameraBody").appendChild(o);
  });
}

$("cameraBody").onchange=()=>{
  const body=$("cameraBody").value;
  $("formatMode").innerHTML=`<option value="">-- Select Format --</option>`;
  if(!CAMERA_DB[body]) return;

  CAMERA_DB[body].forEach((f,i)=>{
    const o=document.createElement("option");
    o.value=i; o.textContent=f.label;
    $("formatMode").appendChild(o);
  });
  $("formatMode").disabled=false;
};

$("formatMode").onchange=()=>{
  const body=$("cameraBody").value;
  const idx=$("formatMode").value;
  activeSensorMM = CAMERA_DB[body][idx]?.vmm ?? null;
};

$("calcBtn").onclick=()=>{
  const f=+$("focal").value;
  const ft=+$("feet").value;
  const inch=+$("inches").value;
  const h=+$("lr_height").value;
  const z=+$("lr_offset").value;

  if(!activeSensorMM||!f) return $("result").innerText="Tilt Angle —";

  const d=(ft*12)+inch;
  const base=Math.atan(-h/(d-z))*180/Math.PI;
  const vfov=2*Math.atan((activeSensorMM/2)/f)*180/Math.PI;

  const frame=document.querySelector("input[name='frame']:checked").value;
  const pos=frame==="top"?0.75:frame==="middle"?0.5:0.25;

  const final=base+(vfov/2)*(0.5-pos);
  $("result").innerText=`Tilt Angle: ${final.toFixed(2)}°`;
};

$("resetBtn").onclick=()=>location.reload();

populateBodies();
</script>
</body>
</html>
